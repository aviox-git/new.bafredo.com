{% extends "layouts/front.twig" %}
{% block styles %}
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs/dt-1.10.20/b-1.6.1/b-colvis-1.6.1/r-2.2.3/sc-2.0.1/sl-1.3.1/datatables.min.css"/>

<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
<link rel="https://cdnjs.cloudflare.com/ajax/libs/datepicker/1.0.9/datepicker.min.css">
    <style type="text/css">
    input[type='file'] {
  color: transparent;
}
        .bodyFrame .pc .accountFrame .leftFrame .accountNav .select {
            background: #0f054a;
            color: #FFFFFF;
        }
        .bodyFrame .pc .accountFrame .rightFrame .btn {
            width: auto;
            height: auto;
            font-size: 12px;
        }
        .btn-danger {
            color: #fff !important;
            background-color: #d9534f !important;
            border-color: #d43f3a !important;
        }
        .progress {
            display: none;
            position: absolute;
            width: 295px;
            background-color: green;
            border: 0px solid blue;
            padding: 0px;
            border-radius: 3px;
        }

        .progress-bar {
            background-color: green;
            width: 0%;
            height: 30px;
            border-radius: 4px;
            -webkit-border-radius: 4px;
            -moz-border-radius: 4px;
        }

        .percent {
            position: absolute;
            display: inline-block;
            color: #fff;
            font-weight: bold;
            top: 50%;
            text-align: center !important;
            margin-top: -9px;
            margin-left: -20px;
            -webkit-border-radius: 4px;
        }
        #errmsg,#errmsg1 {
         color: red;
        }
       .user-img {
        width: 200px;
        height: 200px;
        object-fit: cover;
        border: 0;
        border-image: round;
        }
        
    </style>
{% endblock %}
{% block content %}

<section class="breadcrumb-section">
    <div class="container">
        <div class="row">
            <div class="col-12 col-md-12">
                <div class="breadcrumb-area">
                    <nav aria-label="breadcrumb" class="comn-breadcrumb-nav">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="#"><i class="fa fa-home pr-2"></i>Home</a></li>
                            <li class="breadcrumb-item active" aria-current="page">My Account</li>
                        </ol>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="my-account-section py-5">
    <div class="container">
        <div class="row">
            <div class="col-12 col-md-4">
                <div class="my-account-menu-area">
                    <div class="nav flex-column">
                        
                        <a class="nav-link aMenu_0 {{(page=='account')?'select':''}}" href="{{ base_url('account') }}">My Account</a>
                        <hr>
                        <a class="nav-link aMenu_1 {{(page=='order_history')?'select':''}}" href="{{ base_url('account/order_history') }}">Order History</a>
                        <hr>
                        <a class="nav-link aMenu_2 {{(page=='address_book')?'select':''}}" href="{{ base_url('account/address_book') }}">Address Book</a>
                        <hr>
                         <a class="nav-link aMenu_3 {{(page=='password')?'select':''}}" href="{{ base_url('account/changePassword') }}">Change Password</a>
                        <hr>
                        <a class="nav-link aMenu_3 {{(page=='wish_list')?'select':''}}" href="{{ base_url('account/wish_list') }}">Wishlist</a>
                        <hr>
                        
                        <a class="nav-link" href="{{ base_url('user/logout') }}">Logout</a>

                    </div>
                </div>
            </div>
            <div class="col-12 col-md-8">
                <div class="my-account-area">
                    <div class="my-account-bg-content">
                         {{ include("partials/user/#{page}.twig") }}
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

{% endblock %}

{% block scripts %}
<script type="text/javascript" src="https://cdn.datatables.net/v/bs/dt-1.10.20/b-1.6.1/b-colvis-1.6.1/r-2.2.3/sc-2.0.1/sl-1.3.1/datatables.min.js"></script>

<script src= "https://cdn.datatables.net/buttons/1.6.2/js/buttons.flash.min.js"></script>
<script src= "https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src= "https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
<script src= "https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
<script src= "https://cdn.datatables.net/buttons/1.6.2/js/buttons.html5.min.js"></script>
<script src= "https://cdn.datatables.net/buttons/1.6.2/js/buttons.print.min.js"></script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/datepicker/1.0.9/datepicker.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.22/pdfmake.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.0/jquery.validate.js"></script>
  
    <script>
       
         $("body").on("click", "#btnExport", function () {
            html2canvas($('#dataResult')[0], {
                onrendered: function (canvas) {
                    var data = canvas.toDataURL();
                    var docDefinition = {
                        content: [{
                            image: data,
                            width: 500
                        }]
                    };
                    pdfMake.createPdf(docDefinition).download("Order.pdf");
                }
            });
        });
        
        
        function readProfile(input) {
            
              // alert(input.files[0].size);
                if(input.files[0].size > 2000000) {
                    $('#imgmsg').css('display','block');
                  //  $("#imgmsg").html("Please Enter Numeric values Only").show().fadeOut("slow");
                  //  alert('large');
                    $('#hprofile').value = ''; 
                     return false;
                }else{
                    $('#imgmsg').css('display','none');
                    
                }
            if (input.files && input.files[0]) {
                var reader = new FileReader();

                reader.onload = function (e) {
                    $('.profile').attr('src', '{{ base_url("assets/front/image/loading.gif") }}');
                }
                reader.readAsDataURL(input.files[0]);
                var fd = new FormData();
                var files = input.files[0];
             
                fd.append('file', files);
                var old_image = "{{ user.getUserImg() is empty ? base_url('assets/front/image/profile.png') : base_url("assets/front/image/users/")~user.getUserImg() }}"
                $.ajax({
                    url: '{{ base_url('account/upload_profile') }}',
                    type: 'post',
                    data: fd,
                    contentType: false,
                    processData: false,
                    beforeSend : function() {

                    },
                    xhr: function() {
                        var xhr = new window.XMLHttpRequest();
                        xhr.upload.addEventListener("progress", function(evt) {
                            if (evt.lengthComputable) {
                                var percentComplete = (evt.loaded / evt.total) * 100;
                                $("#progressBar").animate({
                                    width: '' + percentComplete + ''
                                }, {
                                    duration: 5000,
                                    easing: "linear",
                                    step: function (x) {
                                            percentText = Math.round(x * 100 / percentComplete);
                                    }
                                });
                            }
                        }, false);
                        return xhr;
                    },
                    success: function(response){
                        var par_obj = JSON.parse(response);
                        if(par_obj.status == "success"){
                            $('.profile').attr('src', '{{ base_url("assets/front/image/users/")}}'+par_obj.name);
                            toastr.success("Updated succesffully" , {timeOut: 5000});

                        }
                        else{
                            alert(par_obj.name.replace(/<[^>]*>/g, ''));
                            $('.profile').attr('src', old_image);

                        }
                    },
                });
            }
        }

        $("#hprofile").change(function () {
            readProfile(this);
        });
        
   
       $('#orderhistory').DataTable( {
            columnDefs: [ { type: 'date', 'targets': [4] } ],
            order: [[ 4, 'desc' ]], 
            responsive: true,
        //     dom: 'Bfrtip',
        // buttons: [
        //      'pdf'
        // ]
        
        });
        
        // $('#dataResult').DataTable( {
        //     columnDefs: [ { type: 'date', 'targets': [3] } ],
        //     order: [[ 3, 'desc' ]], 
        //     responsive: true,
        //     dom: 'Bfrtip',
        // buttons: [
        //      'pdf'
        // ]
        
        // });
 
       
  
    
    $('#wishlistTable').DataTable( {
        responsive: true
    } );
    

    $("#max").daterangepicker({
        //singleDatePicker: true,        
        //autoUpdateInput: false,
       // autoApply: true
    });
      $("#max").change(function(ev) {
           var firstDate = $(this).val();

            $.ajax({
                  url: "/user/getFile/",
                  type: 'get',
                  data: {"x" : firstDate},
                  dataType : "json",
                  error: function() {
                      alert('Something is wrong');
                  },
                  success: function(data) {
                    
                    $("#DResult").html(data.data);
                   //  $("#check").html('<h1>check</h1>');
                      console.log(data);
                       
                  }
          });
        });

    $(document).ready(function(){
        $("#changePassword").validate({
            rules: {   
                oldpassword: {
                    required: true,
                },
                newpassword:{
                    required: true,
                },
                confirmpassword:{
                    required: true,
                    equalTo: "#newpassword"
                }
            },
            messages: {
                oldpassword: {
                    required: "Current password is required",
                },
                newpassword:{
                     required: "New password is required",
                },
                confirmpassword: " Enter confirm password same as password",
            },
        });
    });
</script>
{% endblock %}
